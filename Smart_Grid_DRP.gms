*Peyman Afzali Gorouh
*Smart Grid Bidding Strategy In Presence of Demand Response Programs
sets
t /t1*t24/
w wind scenario /w1*w10/
s day-ahead price scenario /s1*s10/
;
alias(t,tt);
parameters
alpha /0.95/
beta /0.6/
zeta_pv wind scenario probability /0.1/
zeta_w wind scenario probability /0.1/
zeta_s price scenario probability /0.1/
landa_mean_t_s /53.3444/
landa_positive(t,s)
landa_negative(t,s)
d_t(t) /t1 4.89119000000000,t2 4.55959000000000,t3 4.06218000000000,t4 3.85492000000000,t5 4.35233000000000,t6 4.84974000000000,t7 5.38860000000000,t8 5.18135000000000,t9 5.26425000000000,t10 5.76166000000000,t11 5.63731000000000,t12 6.59067000000000,t13 6.25907000000000,t14 5.88601000000000,t15 5.96891000000000,t16 5.80311000000000,t17 5.47150000000000,t18 6.01036000000000,t19 5.51295000000000,t20 6.13472000000000,t21 7.04663000000000,t22 6.42487000000000,t23 5.59585000000000,t24 5.34715000000000/
wff(t,w)
pvv(t,w)
landa_positive_t_s(t,s)
landa_negative_t_s(t,s)
pv(w,t)
;


table wf(w,t)
               t1                        t2                     t3                     t4                      t5                       t6                      t7                      t8                      t9                     t10                       t11                    t12                     t13                    t14                      t15                     t16                     t17                     t18                    t19                     t20                      t21                     t22                    t23                      t24
w1      5.47974227204433        5.55440000000000        5.92740000000000        4.80820000000000        5.45910650481311        4.84970000000000        6.54920000000000        6.25900000000000        6.50770000000000        5.88600000000000        6.42480000000000        6.09320000000000        6.09403118723262        5.30570000000000        6.42480000000000        4.68390000000000        3.85490000000000        6.14747129597139        4.91707692355491        3.93780000000000        3.48180000000000        3.15020000000000        3.48180000000000        2.52850000000000
w2      6.17610000000000        5.55440000000000        5.92740000000000        4.80820000000000        5.09845000000000        4.84970000000000        6.54920000000000        6.25900000000000        6.50770000000000        5.88600000000000        6.42480000000000        6.09320000000000        5.09840000000000        5.30570000000000        6.42480000000000        4.68390000000000        3.85490000000000        5.10166779973504        5.55440000000000        4.56357703525452        3.48180000000000        3.15020000000000        3.78152076859153        2.52850000000000
w3      6.17610000000000        5.55440000000000        5.51695160030146        4.80820000000000        5.09845000000000        4.84970000000000        6.54920000000000        6.25900000000000        6.50770000000000        5.88600000000000        6.42480000000000        6.09320000000000        5.09840000000000        5.55493079780801        6.42480000000000        4.68390000000000        4.46177293898665        5.51290000000000        5.55440000000000        3.93780000000000        3.48180000000000        3.15020000000000        3.48180000000000        2.52850000000000
w4      6.17610000000000        5.55440000000000        5.92740000000000        5.32557976150633        5.09845000000000        4.84970000000000        6.54920000000000        5.68236396260945        6.50770000000000        5.88600000000000        6.42480000000000        6.09320000000000        5.09840000000000        5.30570000000000        6.42480000000000        4.68390000000000        4.25392552679934        6.32284681507083        5.55440000000000        3.93780000000000        3.48180000000000        3.15020000000000        3.21229998949018        2.52850000000000
w5      5.55659418355418        5.55440000000000        5.92740000000000        4.80820000000000        5.09845000000000        4.84970000000000        6.54920000000000        6.25900000000000        6.50770000000000        5.88600000000000        6.42480000000000        6.09320000000000        5.09840000000000        5.30570000000000        6.42480000000000        4.68390000000000        3.85490000000000        5.51290000000000        5.55440000000000        3.93780000000000        3.48180000000000        2.77869446079157        3.48180000000000        2.52850000000000
w6      6.97516180358964        5.55440000000000        5.92740000000000        4.80820000000000        4.91712373898186        4.84970000000000        6.54920000000000        6.25900000000000        6.50770000000000        5.88600000000000        6.42480000000000        6.09320000000000        4.13057920044759        5.30570000000000        6.42480000000000        4.68390000000000        3.85490000000000        5.51290000000000        5.55440000000000        3.93780000000000        3.48180000000000        3.15020000000000        3.48180000000000        2.52850000000000
w7      6.17610000000000        6.13372928938891        5.92740000000000        4.76489190362490        5.09845000000000        5.40520841932398        6.54920000000000        6.25900000000000        6.50770000000000        5.88600000000000        6.42480000000000        6.09320000000000        5.09840000000000        5.30570000000000        6.42480000000000        4.68390000000000        3.85490000000000        5.51290000000000        5.55440000000000        4.13165430080765        3.48180000000000        3.15020000000000        4.36802818237563        2.52850000000000
w8      6.17610000000000        5.55440000000000        5.92740000000000        4.80820000000000        5.48648806997421        4.84970000000000        6.54920000000000        6.91123638867871        6.50770000000000        5.88600000000000        6.42480000000000        6.09320000000000        5.49676706413954        5.30570000000000        7                       4.68390000000000        3.85490000000000        5.51290000000000        6.32865140851246        3.93780000000000        4.34150225422645        2.53319817469580        3.36576506147168        2.52850000000000
w9      6.17610000000000        5.55440000000000        5.01830480715016        4.80820000000000        5.09845000000000        4.84970000000000        6.54920000000000        6.25900000000000        6.50770000000000        5.88600000000000        6.42480000000000        6.09320000000000        5.09840000000000        5.30570000000000        6.42480000000000        4.17448413424254        4.37987417345994        5.51290000000000        5.55440000000000        3.93780000000000        3.48180000000000        3.15020000000000        3.48180000000000        2.52850000000000
w10     6.17610000000000        5.55440000000000        5.92740000000000        4.80820000000000        4.90384199456292        4.84970000000000        6.54920000000000        6.25900000000000        6.50770000000000        5.88600000000000        6.93806812782817        5.67937515789156        5.09840000000000        5.30570000000000        6.61266612739480        4.68390000000000        3.85490000000000        5.51290000000000        6.28015276095454        3.93780000000000        3.50852286913156        3.15020000000000        3.48180000000000        2.83832086933144 ;

wff(t,w)=wf(w,t);

table pv(w,t)
               t1                        t2                     t3                     t4                      t5                       t6                      t7                      t8                      t9                     t10                       t11                    t12                     t13                    t14                      t15                     t16                     t17                     t18                    t19                     t20                      t21                     t22                    t23                      t24
w1             0                         0                      0                      0               0.834209748393179        1.13312391039318        1.67690128239318        2.34520599339318        2.78332540839318        3.21986285739318        3.49444145439318        3.64516176339318        3.62627931339318        3.43860792339318        3.12638979039318        2.73014891439318        2.25497971539318        1.52096598639318        1.05076056339318        0.817114065393179                0                       0                      0                        0
w2             0                         0                      0                      0               0.925277999075619        1.22419216107562        1.76796953307562        2.43627424407562        2.87439365907562        3.31093110807562        3.58550970507562        3.73623001407562        3.71734756407562        3.52967617407562        3.21745804107562        2.82121716507562        2.34604796607562        1.61203423707562        1.14182881407562        0.908182316075619                0                       0                      0                        0
w3             0                         0                      0                      0               0.146472878293506        0.445387040293506        0.989164412293506        1.65746912329351        2.09558853829351        2.53212598729351        2.80670458429351        2.95742489329351        2.93854244329351        2.75087105329351        2.43865292029351        2.04241204429351        1.56724284529351        0.833229116293506        0.363023693293506    0.129377195293506                0                       0                      0                        0
w4             0                         0                      0                      0               0.932861918139019        1.23177608013902        1.77555345213902        2.44385816313902        2.88197757813902        3.31851502713902        3.59309362413902        3.74381393313902        3.72493148313902        3.53726009313902        3.22504196013902        2.82880108413902        2.35363188513902        1.61961815613902        1.14941273313902        0.915766235139019                0                       0                      0                        0
w5             0                         0                      0                      0               0.651845308225410        0.950759470225410        1.49453684222541        2.16284155322541        2.60096096822541        3.03749841722541        3.31207701422541        3.46279732322541        3.44391487322541        3.25624348322541        2.94402535022541        2.54778447422541        2.07261527522541        1.33860154622541        0.868396123225410      0.634749625225410                0                       0                      0                        0
w6             0                         0                      0                      0               0.117026466999410        0.415940628999410        0.959718000999410        1.62802271199941        2.06614212699941        2.50267957599941        2.77725817299941        2.92797848199941        2.90909603199941        2.72142464199941        2.40920650899941        2.01296563299941        1.53779643399941        0.803782704999410        0.333577281999410    0.0999307839994095               0                       0                      0                        0
w7             0                         0                      0                      0               0.297984280867048        0.596898442867048        1.14067581486705        1.80898052586705        2.24709994086705        2.68363738986705        2.95821598686705        3.10893629586705        3.09005384586705        2.90238245586705        2.59016432286705        2.19392344686705        1.71875424786705        0.984740518867048        0.514535095867049     0.280888597867048                0                       0                      0                        0
w8             0                         0                      0                      0               0.566367581204984        0.865281743204984        1.40905911520498        2.07736382620498        2.51548324120498        2.95202069020498        3.22659928720498        3.37731959620498        3.35843714620498        3.17076575620498        2.85854762320498        2.46230674720498        1.98713754820498        1.25312381920498        0.782918396204984      0.549271898204984                0                       0                      0                        0
w9             0                         0                      0                      0               0.976992897434298        1.27590705943430        1.81968443143430        2.48798914243430        2.92610855743430        3.36264600643430        3.63722460343430        3.78794491243430        3.76906246243430        3.58139107243430        3.26917293943430        2.87293206343430        2.39776286443430        1.66374913543430        1.19354371243430        0.959897214434298                0                       0                      0                        0
w10            0                         0                      0                      0               0.984374597199277        1.28328875919928        1.82706613119928        2.49537084219928        2.93349025719928        3.37002770619928        3.64460630319928        3.79532661219928        3.77644416219928        3.58877277219928        3.27655463919928        2.88031376319928        2.40514456419928        1.67113083519928        1.20092541219928        0.967278914199277                0                       0                      0                        0   ;

pvv(t,w)=pv(w,t);

table landa_t_s(s,t)
               t1                        t2                     t3                     t4                      t5                       t6                      t7                      t8                      t9                     t10                       t11                    t12                     t13                    t14                      t15                     t16                     t17                     t18                    t19                     t20                      t21                     t22                    t23                      t24
s1      46.7188972738895        45.6299057204720        37.1584000000000        36.7645000000000        44.2048000000000        43.1707367985379        56.1997000000000        47.1449000000000        53.7604000000000        53.1091783401531        53.7973000000000        63.2995000000000        57.5446000000000        52.2011000000000        53.8691000000000        61.3094000000000        59.2650000000000        56.3967000000000        54.3532000000000        63.0307000000000        76.2486089135129        68.8399000000000        51.5375000000000        46.6064000000000
s2      46.0935943120270        45.3886000000000        37.1584000000000        37.6239832743734        44.2048000000000        43.8099000000000        56.1997000000000        47.7587417792842        53.7604000000000        52.5417000000000        53.7973000000000        63.2995000000000        57.5446000000000        51.9944195930880        53.8691000000000        61.3094000000000        59.2650000000000        56.7209548112121        54.3532000000000        63.0307000000000        75.4196000000000        68.8399000000000        51.4078813761833        46.6064000000000
s3      46.1949000000000        45.3886000000000        38.0195248013710        36.7645000000000        44.2048000000000        43.8099000000000        56.1997000000000        47.1449000000000        53.7604000000000        52.5417000000000        53.7973000000000        63.2995000000000        57.5446000000000        52.2011000000000        53.8691000000000        61.3094000000000        60.1904252809865        56.3967000000000        54.2973547449655        63.0307000000000        74.5989669115513        68.8399000000000        51.5375000000000        46.6064000000000
s4      46.1949000000000        45.3886000000000        37.1584000000000        36.7645000000000        44.2048000000000        44.6943558662524        56.1997000000000        47.1449000000000        53.9750409673961        52.5417000000000        53.7973000000000        63.7763801416415        57.5446000000000        52.2011000000000        53.3390338903968        61.3094000000000        59.2650000000000        56.3967000000000        54.3532000000000        63.0307000000000        75.4196000000000        68.8399000000000        50.8513413417113        46.6064000000000
s5      46.1949000000000        45.3886000000000        37.1584000000000        36.7645000000000        44.9562754298476        43.8099000000000        56.1997000000000        47.1449000000000        53.7604000000000        52.5417000000000        53.7973000000000        63.2995000000000        57.5446000000000        52.2011000000000        53.8691000000000        60.5786431717344        59.5890610311175        56.3967000000000        54.3532000000000        63.0307000000000        76.0823759602090        68.8399000000000        51.5375000000000        46.6064000000000
s6      46.1949000000000        45.3886000000000        37.1584000000000        36.7645000000000        44.2048000000000        43.8099000000000        56.1997000000000        47.1449000000000        53.7604000000000        52.5417000000000        53.7973000000000        62.4150842859991        57.5446000000000        52.2011000000000        53.8691000000000        61.3094000000000        59.1204631426981        56.3967000000000        54.3532000000000        63.0307000000000        75.4196000000000        68.8399000000000        52.4219156537631        46.6064000000000
s7      46.1949000000000        45.3886000000000        37.1584000000000        36.7645000000000        44.2048000000000        43.8099000000000        55.3876602588753        47.1449000000000        53.7604000000000        52.5417000000000        53.7973000000000        63.2995000000000        57.5446000000000        52.1225408186514        53.8691000000000        61.3094000000000        59.2650000000000        56.3967000000000        54.3532000000000        63.0307000000000        75.4196000000000        68.8399000000000        51.1948141033733        46.6064000000000
s8      46.1949000000000        45.3886000000000        37.8466903484207        36.7645000000000        44.2048000000000        43.7701204557961        55.7846575312462        46.9175549010269        53.7604000000000        52.5417000000000        53.7973000000000        63.2995000000000        57.5446000000000        52.0077598719685        54.6857144407831        61.3094000000000        59.2650000000000        56.3967000000000        54.3532000000000        63.0307000000000        75.4196000000000        68.8399000000000        51.5375000000000        46.6064000000000
s9      46.1949000000000        45.3886000000000        37.1584000000000        36.7645000000000        44.2048000000000        43.8099000000000        56.1997000000000        47.1449000000000        53.7604000000000        52.5417000000000        53.7973000000000        64.2738158725731        57.5446000000000        51.7323341494791        53.8691000000000        62.2711949197048        59.2650000000000        56.3967000000000        54.3532000000000        62.6833903294300        75.4196000000000        68.8399000000000        51.5375000000000        46.6064000000000
s10     46.1949000000000        45.3886000000000        37.1584000000000        36.7645000000000        44.0037546583002        43.8099000000000        56.9957912123333        47.1449000000000        53.7604000000000        52.5417000000000        53.3570192284578        63.2995000000000        57.5446000000000        52.2011000000000        53.8691000000000        61.3094000000000        59.2650000000000        56.3967000000000        54.3532000000000        63.4422347086723        75.4196000000000        68.8399000000000        51.5375000000000        46.6064000000000  ;

landa_positive_t_s(t,s)=0.9*landa_t_s(s,t);
landa_negative_t_s(t,s)=1.1*landa_t_s(s,t);

variables
z
EP_s_w(s,w)
eta(s,w)
www(t)
pvvv(t)
rou_positive(t,w)
rou_negative(t,w)
dr_positive(t,w)
dr_negative(t,w)
peta_positive(t,s)
peta_negative(t,s)
DR(t,s)
DRpositive(t)
DRnegative(t)
sigma_positive(t,w)
sigma_negative(t,w)
VAR
CVAR
SoC(t)
x(t)
y(t)
CHV2G(t)
DSCHV2G(t)
;
positive variables
SoC(t)
CHV2G(t)
DSCHV2G(t)
www(t)
pvvv(t)
peta_positive(t,s)
peta_negative(t,s)
;
binary variables
n(t,w)
v(t,s)
x(t)
;
scalars
cross_elasticity /0.01/
own_elasticity /0.75/
y_t_plus /0.1/
y_t_minus /0.1/
c /2.3/
;
CHV2G.up(t)=0.6;
DSCHV2G.up(t)=0.6;
SoC.up(t)=0.9;
SoC.lo(t)=0.3;
SoC.fx('t1')=0;
SoC.fx('t24')=0;

equations
objective_function
CVAR_eq
DR_eq
EP_s_w_eq
DR_positive_eq
DR_negative_eq
DR_plus_eq1
DR_plus_eq2
DR_minus_eq1
DR_minus_eq2
rou_positive_eq1
rou_positive_eq2
rou_negative_eq1
rou_negative_eq2
sigma_positive_eq
sigma_negative_eq
peta_positive_eq
peta_negative_eq
tazmin
tazmin2
VAR_constraint_eq
eta_eq
Constraint6
;

*equation 3
CVAR_eq.. CVAR=e=VAR-(1/(1-alpha))*sum((s,w),zeta_s*zeta_w*zeta_pv*eta(s,w));
*equation 2
EP_s_w_eq(s,w).. EP_s_w(s,w)=e=sum(t,landa_t_s(s,t)*www(t)+landa_t_s(s,t)*pvvv(t)+landa_positive_t_s(t,s)*sigma_positive(t,w)-landa_negative_t_s(t,s)*sigma_negative(t,w)-dr_positive(t,w)*y_t_plus-dr_negative(t,w)*y_t_minus-(DRpositive(t)+DRnegative(t))*c-sum(tt,((CHV2G(tt)-DSCHV2G(tt))*landa_t_s(s,tt))));
*equation 1
objective_function.. z=e=sum((w,s),(1-beta)*zeta_s*zeta_w*zeta_pv*EP_s_w(s,w))+beta*CVAR;
*equation 4
VAR_constraint_eq(s,w).. -VAR+EP_s_w(s,w)-eta(s,w)=g=0;
*equation 5
eta_eq(s,w).. eta(s,w)=g=0;
*equation 6
DR_eq(t,s).. DR(t,s)=e=sum(tt$(ord(t) ne ord(tt)),cross_elasticity*((d_t(t)*1.5+d_t(tt)*1.5)/2)*((peta_positive(t,s)+peta_negative(t,s))/landa_mean_t_s));
*equation 7
DR_positive_eq(t).. DRpositive(t)=l=sum(s,zeta_s*DR(t,s));
*equation 8
DR_negative_eq(t).. DRnegative(t)=l=sum(s,zeta_s*DR(t,s));
*equation 9
DR_plus_eq1(t,w).. dr_positive(t,w)=g=0;
DR_plus_eq2(t,w).. dr_positive(t,w)=l=DRpositive(t);
*equation 10
DR_minus_eq1(t,w).. dr_negative(t,w)=g=0;
DR_minus_eq2(t,w).. dr_negative(t,w)=l=DRnegative(t);
*equation 11
rou_positive_eq1(t,w).. rou_positive(t,w)=e=n(t,w)*((-CHV2G(t)+DSCHV2G(t))+wff(t,w)+pvv(t,w)-www(t)-pvvv(t));
rou_positive_eq2(t,w).. rou_positive(t,w)=g=0;
*equation 12
rou_negative_eq1(t,w).. rou_negative(t,w)=e=(1-n(t,w))*(www(t)+pvvv(t)-wff(t,w)-pvv(t,w)-(-CHV2G(t)+DSCHV2G(t)));
rou_negative_eq2(t,w).. rou_negative(t,w)=g=0;
*equation 15
sigma_positive_eq(t,w).. sigma_positive(t,w)=e=rou_positive(t,w)-dr_positive(t,w);
*equation 16
sigma_negative_eq(t,w).. sigma_negative(t,w)=e=rou_negative(t,w)-dr_negative(t,w);
*equation 17
peta_positive_eq(t,s).. peta_positive(t,s)=e=v(t,s)*(landa_t_s(s,t)-landa_mean_t_s);
*equation 18
peta_negative_eq(t,s).. peta_negative(t,s)=e=(1-v(t,s))*(landa_mean_t_s-landa_t_s(s,t));
*equation 19
tazmin.. sum(t,(DRpositive(t)+DRnegative(t))*c)=g=sum((t,s),zeta_s*DRpositive(t)*peta_positive(t,s)+zeta_s*DRnegative(t)*peta_negative(t,s));
*equation 20
tazmin2.. sum(t,DRpositive(t))=g=sum(t,DRnegative(t))-sum((t,s),zeta_s*own_elasticity*d_t(t)*1.5*(peta_positive(t,s)-peta_negative(t,s))/landa_mean_t_s);

Constraint6(t).. SoC(t)=e=SoC(t-1)+(CHV2G(t)*(0.95)-DSCHV2G(t)/0.95);


model pairing_dr_wind /all/;
option MINLP=COUENNE;
solve pairing_dr_wind using MINLP maximizing z;
options decimals=2;
display z.l,DRpositive.l,DRnegative.l,pvvv.l,www.l,EP_s_w.l,dr_negative.l,dr_positive.l,CHV2G.l,DSCHV2G.l,SoC.l,CVAR.l,VAR.l,peta_positive.l,peta_negative.l,DR.l;

execute_unload 'D:\UCout.gdx',z,DRpositive,DRnegative,pvvv,www,EP_s_w.l,dr_negative,dr_positive,CHV2G,DSCHV2G,SoC,CVAR,VAR,peta_positive,peta_negative,DR;
execute 'gdxviewer.exe i=D:\UCout.gdx';
